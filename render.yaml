# Render.com deployment configuration
# https://docs.render.com/blueprint-spec

services:
  - type: web
    name: owls-backend
    runtime: python
    buildCommand: "./build.sh"
    startCommand: "gunicorn backend.wsgi:application"
    envVars:
      - key: PYTHON_VERSION
        value: "3.10.12"
      - key: DJANGO_DEBUG
        value: "False"
      - key: DJANGO_ALLOWED_HOSTS
        value: "api.owls.asia,localhost,127.0.0.1" # Using value from .env, but can be overridden
      - key: DJANGO_SECURE_SSL_REDIRECT
        value: "True"
      - key: DATABASE_URL
        fromDatabase:
          name: owls-db
          property: connectionString
      # Secrets (sync: false)
      - key: DJANGO_SECRET_KEY
        sync: false
      - key: JWT_SIGNING_KEY
        sync: false
      - key: JWT_PRIVATE_KEY_B64
        sync: false
      - key: JWT_PUBLIC_KEY_B64
        sync: false
      - key: AWS_ACCESS_KEY_ID
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        sync: false
      - key: AWS_STORAGE_BUCKET_NAME
        value: "owls"
      - key: AWS_S3_ENDPOINT_URL
        value: "https://45411ffcbcfff6dd4882789683e1d0a1.r2.cloudflarestorage.com"
      - key: AWS_S3_CUSTOM_DOMAIN
        value: "cdn.owls.asia"
      - key: USE_S3
        value: "True"
      - key: EMAIL_HOST_USER
        sync: false
      - key: EMAIL_HOST_PASSWORD
        sync: false
      - key: STRIPE_PUBLIC_KEY
        sync: false
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false
      - key: VNPAY_TMN_CODE
        sync: false
      - key: VNPAY_HASH_SECRET
        sync: false
      - key: MOMO_PARTNER_CODE
        sync: false
      - key: MOMO_ACCESS_KEY
        sync: false
      - key: MOMO_SECRET_KEY
        sync: false
      - key: GHN_API_TOKEN
        sync: false
      - key: GHN_SHOP_ID
        sync: false
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      - key: GITHUB_CLIENT_ID
        sync: false
      - key: GITHUB_CLIENT_SECRET
        sync: false
      - key: SENTRY_DSN
        sync: false
      # Public/Config variables
      - key: CORS_ALLOWED_ORIGINS
        value: "https://owls.asia,https://admin.owls.asia,http://localhost:3000"
      - key: CSRF_TRUSTED_ORIGINS
        value: "https://owls.asia,https://admin.owls.asia,http://localhost:3000"
      - key: WEB_CONCURRENCY
        value: "4"

databases:
  - name: owls-db
    plan: free
    databaseName: owls
    user: owls_user